tosca_definitions_version: cloudify_dsl_1_1
imports:
  - http://www.getcloudify.org/spec/cloudify/3.2.1/types.yaml
  - https://raw.githubusercontent.com/tonybaloney/cloudify-libcloud-plugin/dimensiondata_support/plugin.yaml

inputs:
  host_ip:
    description: >
      The ip of the host the application will be deployed on
  agent_user:
    description: >
      User name used when SSH-ing into the started machine
  agent_private_key_path:
    description: >
      Path to a private key that resided on the management machine.
      SSH-ing into agent machines will be done with this key.
  api_username:
    description: >
      Username for the CaaS API
  api_password:
    description: >
      Password for the CaaS API
  target_region:
    description: >
      One of the regions (dd-au, dd-na, dd-ap)
  vm_name:
    description: >
      Name of the node to create
  node_description:
    description: >
      Description of the node to create
  network_name:
    description: >
      Name of the MCP 1.0 network to create the node into
  image_name:
    description: >
      Name of the base image to use

node_templates:
  host:
    type: cloudify.libcloud.nodes.Server
    properties:
      connection_config:
        cloud_provider_name: DIMENSIONDATA
        access_id: { get_input: api_username }
        secret_key: { get_input: api_password }
        region: { get_input: target_region }
      name: { get_input: vm_name }
      image_name: { get_input: image_name }
      network_name: { get_input: network_name }
      node_description: { get_input: node_description }
      ip: { get_input: host_ip }
      cloudify_agent:
        user: { get_input: agent_user }
        key: { get_input: agent_private_key_path }